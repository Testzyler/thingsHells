{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "test_cus_table",
    "name" : "test_cus_table_by_PAO_03_AUG",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "static",
      "sizeX" : 12.5,
      "sizeY" : 9.5,
      "resources" : [ {
        "url" : "https://code.jquery.com/jquery-3.7.1.js",
        "isModule" : false
      }, {
        "url" : "https://cdn.datatables.net/2.1.3/js/dataTables.min.js",
        "isModule" : false
      }, {
        "url" : "https://cdn.datatables.net/2.1.3/css/dataTables.dataTables.min.css",
        "isModule" : false
      } ],
      "templateHtml" : "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\" />\r\n    <meta name=\"viewport\"\r\n        content=\"width=device-width, initial-scale=1.0\" />\r\n    <title>API Data Table</title>\r\n    <script src=\"https://code.jquery.com/jquery-3.7.1.js\">\r\n    </script>\r\n    <script\r\n        src=\"https://cdn.datatables.net/2.1.3/js/dataTables.min.js\">\r\n    </script>\r\n    <link rel=\"stylesheet\"\r\n        href=\"https://cdn.datatables.net/2.1.3/css/dataTables.dataTables.min.css\" />\r\n    <link\r\n        href=\"https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css\"\r\n        rel=\"stylesheet\" />\r\n    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n</head>\r\n\r\n\r\n<body>\r\n    <header class=\"px-4 pt-2\">\r\n        <h1 class=\"text-2xl font-bold\">CRUD REST API TABLE\r\n        </h1>\r\n    </header>\r\n    <main>\r\n        <span id=\"demo\"></span>\r\n        <section class=\"flex flex-col gap-4\">\r\n            <div\r\n                class=\"table-header flex flex-row gap-2 px-4\">\r\n                <!-- Create Customer Button -->\r\n                <button\r\n                    class=\"bg-blue-500 text-white px-4 py-2 rounded\"\r\n                    type=\"button\">\r\n                    Create New Group\r\n                </button>\r\n                <!-- Create Customer Button -->\r\n                <button\r\n                    class=\"bg-blue-500 text-white px-4 py-2 rounded\"\r\n                    type=\"button\"\r\n                    onclick=\"toggleModal('CreateNewCustomer')\">\r\n                    Create New Customer\r\n                </button>\r\n            </div>\r\n            <table id=\"dataTable\" class=\"display\"\r\n                style=\"width: 100%\">\r\n                <thead>\r\n                    <tr>\r\n                        <th></th>\r\n                        <th>Group ID</th>\r\n                        <th>Group Name</th>\r\n                        <th>Actions</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <!-- Data will be filled here -->\r\n                </tbody>\r\n            </table>\r\n        </section>\r\n    </main>\r\n\r\n    <!-- Create Customer Modal -->\r\n    <div id=\"CreateNewCustomer\"\r\n        class=\"create-customer-modal fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex justify-center items-center transition-opacity duration-300 ease-in-out opacity-0\">\r\n        <!-- Modal content -->\r\n        <div\r\n            class=\"bg-white rounded-lg w-1/2 transform transition-transform duration-300 ease-in-out scale-95 modal-content\">\r\n            <div\r\n                class=\"px-4 py-2 border-b border-gray-200 flex justify-between items-center\">\r\n                <h5 class=\"text-xl font-medium\">Create New\r\n                    Customer</h5>\r\n                <button type=\"button\"\r\n                    class=\"text-gray-600 hover:text-gray-900\"\r\n                    onclick=\"toggleModal('CreateNewCustomer')\">\r\n                    &times;\r\n                </button>\r\n            </div>\r\n            <div class=\"p-4\">\r\n                <form onsubmit=\"\">\r\n                    <div\r\n                        class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label for=\"cus_group_id\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Group</label>\r\n                            <select id=\"cus_group_id\"\r\n                                name=\"cus_group_id\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\">\r\n                                <option value=\"\" disabled\r\n                                    selected>Select a group\r\n                                </option>\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"cus_usage_type\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Usage\r\n                                Type</label>\r\n                            <select id=\"cus_usage_type\"\r\n                                name=\"cus_usage_type\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\">\r\n                                <option value=\"\" disabled\r\n                                    selected>Select a type\r\n                                </option>\r\n                                <option value=\"1\">Type 1\r\n                                </option>\r\n                                <option value=\"2\">Type 2\r\n                                </option>\r\n                                <option value=\"3\">Type 3\r\n                                </option>\r\n                                <option value=\"4\">Type 4\r\n                                </option>\r\n                                <option value=\"5\">Type 5\r\n                                </option>\r\n                                <option value=\"6\">Type 6\r\n                                </option>\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"fname\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">First\r\n                                Name</label>\r\n                            <input type=\"text\" id=\"fname\"\r\n                                name=\"fname\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"lname\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Last\r\n                                Name</label>\r\n                            <input type=\"text\" id=\"lname\"\r\n                                name=\"lname\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"org_name\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Organization</label>\r\n                            <input type=\"text\" id=\"org_name\"\r\n                                name=\"org_name\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"tax_num\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Tax</label>\r\n                            <input type=\"text\" id=\"tax_num\"\r\n                                name=\"tax_num\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"email_name\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Email</label>\r\n                            <input type=\"email\"\r\n                                id=\"email_name\"\r\n                                name=\"email_name\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"phone_num\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Phone</label>\r\n                            <input type=\"tel\" id=\"phone_num\"\r\n                                name=\"phone_num\"\r\n                                maxlength=\"10\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"address_name\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Address</label>\r\n                            <input type=\"text\"\r\n                                id=\"address_name\"\r\n                                name=\"address_name\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"cus_dis_type\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Discount\r\n                                Type</label>\r\n                            <select id=\"cus_dis_type\"\r\n                                name=\"cus_dis_type\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\">\r\n                                <option value=\"\" disabled\r\n                                    selected>\r\n                                    Select a discount type\r\n                                </option>\r\n                                <option value=\"1\">Discount\r\n                                    Type 1</option>\r\n                                <option value=\"2\">Discount\r\n                                    Type 2</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div\r\n                        class=\"mt-4 flex justify-end space-x-2\">\r\n                        <button type=\"button\"\r\n                            class=\"bg-gray-500 text-white px-4 py-2 rounded\"\r\n                            onclick=\"toggleModal('CreateNewCustomer')\">\r\n                            Close\r\n                        </button>\r\n                        <button id=\"createCustomerBtn\"\r\n                            type=\"button\"\r\n                            class=\"bg-blue-500 text-white px-4 py-2 rounded\">\r\n                            Create\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Update Customer Modal -->\r\n    <div id=\"EditCustomer\"\r\n        class=\"edit-customer-modal fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex justify-center items-center transition-opacity duration-300 ease-in-out opacity-0\">\r\n        <!-- Modal content -->\r\n        <div\r\n            class=\"bg-white rounded-lg w-1/2 transform transition-transform duration-300 ease-in-out scale-95 modal-content\">\r\n            <div\r\n                class=\"px-4 py-2 border-b border-gray-200 flex justify-between items-center\">\r\n                <h5 class=\"text-xl font-medium\">Update\r\n                    Customer</h5>\r\n                <button type=\"button\"\r\n                    class=\"text-gray-600 hover:text-gray-900\"\r\n                    onclick=\"toggleModal('EditCustomer')\">\r\n                    &times;\r\n                </button>\r\n            </div>\r\n            <div class=\"p-4\">\r\n                <div class=\"\">\r\n                    <h5 id=\"groupIDUpdate\"\r\n                        class=\"text-xl font-medium\">Group ID\r\n                    </h5>\r\n                </div>\r\n                <form onsubmit=\"\">\r\n                    <div\r\n                        class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label for=\"cus_group_id_update\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Group</label>\r\n                            <select id=\"cus_group_id_update\"\r\n                                name=\"cus_group_id_update\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\">\r\n                                <option value=\"\" disabled\r\n                                    selected>Select a group\r\n                                </option>\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label\r\n                                for=\"cus_usage_type_update\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Usage\r\n                                Type</label>\r\n                            <select\r\n                                id=\"cus_usage_type_update\"\r\n                                name=\"cus_usage_type_update\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\">\r\n                                <option value=\"\" disabled\r\n                                    selected>Select a type\r\n                                </option>\r\n                                <option value=\"1\">Type 1\r\n                                </option>\r\n                                <option value=\"2\">Type 2\r\n                                </option>\r\n                                <option value=\"3\">Type 3\r\n                                </option>\r\n                                <option value=\"4\">Type 4\r\n                                </option>\r\n                                <option value=\"5\">Type 5\r\n                                </option>\r\n                                <option value=\"6\">Type 6\r\n                                </option>\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"title_update\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Title:</label>\r\n                            <input type=\"text\"\r\n                                id=\"title_update\"\r\n                                name=\"title_update\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"org_name_update\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Organization</label>\r\n                            <input type=\"text\"\r\n                                id=\"org_name_update\"\r\n                                name=\"org_name_update\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"tax_num_update\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Tax</label>\r\n                            <input type=\"text\"\r\n                                id=\"tax_num_update\"\r\n                                name=\"tax_num_update\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"email_name_update\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Email</label>\r\n                            <input type=\"email\"\r\n                                id=\"email_name_update\"\r\n                                name=\"email_name_update\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"phone_num_update\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Phone</label>\r\n                            <input type=\"tel\"\r\n                                id=\"phone_num_update\"\r\n                                name=\"phone_num_update\"\r\n                                maxlength=\"10\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"address_name_update\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Address</label>\r\n                            <input type=\"text\"\r\n                                id=\"address_name_update\"\r\n                                name=\"address_name_update\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\" />\r\n                        </div>\r\n                        <div>\r\n                            <label for=\"cus_dis_type_update\"\r\n                                class=\"block mb-2 text-sm font-medium text-gray-700\">Discount\r\n                                Type</label>\r\n                            <select id=\"cus_dis_type_update\"\r\n                                name=\"cus_dis_type_update\"\r\n                                class=\"block w-full p-2 border border-gray-300 rounded\">\r\n                                <option value=\"\" disabled\r\n                                    selected>\r\n                                    Select a discount type\r\n                                </option>\r\n                                <option value=\"1\">Discount\r\n                                    Type 1</option>\r\n                                <option value=\"2\">Discount\r\n                                    Type 2</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div\r\n                        class=\"mt-4 flex justify-end space-x-2\">\r\n                        <button type=\"button\"\r\n                            class=\"bg-gray-500 text-white px-4 py-2 rounded\"\r\n                            onclick=\"toggleModal('EditCustomer')\">\r\n                            Close\r\n                        </button>\r\n                        <button id=\"updateCustomerBtn\"\r\n                            type=\"button\"\r\n                            class=\"bg-blue-500 text-white px-4 py-2 rounded\">\r\n                            Update\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Delete Customer Modal -->\r\n    <div id=\"DeleteCustomer\"\r\n        class=\"delete-customer-modal fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex justify-center items-center transition-opacity duration-300 ease-in-out opacity-0\">\r\n        <div\r\n            class=\"bg-white max-w-[500px] rounded-lg w-1/2 transform transition-transform duration-300 ease-in-out scale-95 modal-content\">\r\n            <div\r\n                class=\"p-4 border-b border-gray-200 flex justify-between items-center\">\r\n                <h2 class=\"text-xl font-medium\">Delete\r\n                    Customer</h2>\r\n                <button type=\"button\"\r\n                    class=\"text-gray-600 hover:text-gray-900 text-xl\"\r\n                    onclick=\"toggleModal('DeleteCustomer')\">\r\n                    &times;\r\n                </button>\r\n            </div>\r\n            <div\r\n                class=\"p-4 flex flex-col justify-center gap-4\">\r\n                <p class=\"text-gray-700 text-lg\">\r\n                    Are you sure you want to delete this\r\n                    customer?\r\n                </p>\r\n                <div class=\"flex justify-end gap-4\">\r\n                    <button id=\"confirmDeleteButton\"\r\n                        class=\"bg-red-500 text-white p-2 rounded text-lg font-semibold\">\r\n                        Yes, Delete\r\n                    </button>\r\n                    <button id=\"cancelDeleteButton\"\r\n                        class=\"bg-gray-500 text-white p-2 rounded text-lg font-semibold\"\r\n                        onclick=\"toggleModal('DeleteCustomer')\">\r\n                        No, Cancel\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!--<script src=\"widget.js\"></script>-->\r\n    <script></script>\r\n</body>\r\n\r\n</html>",
      "templateCss" : "/* General styles */\r\n/*body {*/\r\n/*    font-family: Arial, sans-serif;*/\r\n/*    font-size: 1.25rem;*/\r\n/*    background-color: #f6f8fa;*/\r\n/*    margin: 0;*/\r\n/*    padding: 0;*/\r\n/*    color: #333;*/\r\n/*}*/\r\n\r\n/* Header styles */\r\n/*header {*/\r\n/*    background-color: #2c3e50;*/\r\n/*    color: #fff;*/\r\n/*    padding: 1rem;*/\r\n/*    text-align: center;*/\r\n/*}*/\r\n\r\n/* Main styles */\r\n/*main {*/\r\n/*    padding: 1rem;*/\r\n/*}*/\r\n\r\n/*section {*/\r\n/*    display: flex;*/\r\n/*    flex-direction: column;*/\r\n/*    align-items: stretch;*/\r\n/*}*/\r\n\r\n/*.table-header {*/\r\n/*    display: flex;*/\r\n/*    justify-content: flex-end;*/\r\n/*    margin-bottom: 1rem;*/\r\n/*}*/\r\n\r\n/*#createButton {*/\r\n/*    margin-bottom: 1rem;*/\r\n/*}*/\r\n\r\n/* Table styles */\r\n/*table {*/\r\n/*    width: 100%;*/\r\n/*    border-collapse: collapse;*/\r\n/*    margin: 2rem 0;*/\r\n/*}*/\r\n\r\n/*thead {*/\r\n/*    background-color: #2c3e50;*/\r\n/*    color: #fff;*/\r\n/*}*/\r\n\r\n/*th, td {*/\r\n/*    padding: 1rem;*/\r\n/*    text-align: left;*/\r\n/*    border-bottom: 1px solid #ddd;*/\r\n/*}*/\r\n\r\n/*tbody tr:hover {*/\r\n/*    background-color: #f1f1f1;*/\r\n/*}*/\r\n\r\n/*td {*/\r\n/*    line-height: 1.5rem;*/\r\n/*}*/\r\n\r\n/* Button styles */\r\n/*button {*/\r\n/*    margin: 0.5rem 0;*/\r\n/*    padding: 0.5rem 1rem;*/\r\n/*    background-color: #2c3e50;*/\r\n/*    color: #fff;*/\r\n/*    border: none;*/\r\n/*    cursor: pointer;*/\r\n/*}*/\r\n\r\n/*button:hover {*/\r\n/*    background-color: #34495e;*/\r\n/*}*/\r\n\r\n/* Modal styles */\r\n/*.modal {*/\r\n/*    display: none;*/\r\n/*    position: fixed;*/\r\n/*    z-index: 1;*/\r\n/*    left: 0;*/\r\n/*    top: 0;*/\r\n/*    width: 100%;*/\r\n/*    height: 100%;*/\r\n/*    overflow: auto;*/\r\n/*    background-color: rgba(0, 0, 0, 0.4);*/\r\n/*    padding-top: 60px;*/\r\n/*}*/\r\n\r\n/*.modal-content {*/\r\n/*    background-color: #fefefe;*/\r\n/*    margin: 5% auto;*/\r\n/*    padding: 20px;*/\r\n/*    border: 1px solid #888;*/\r\n/*    width: 80%;*/\r\n/*}*/\r\n\r\n/*.close {*/\r\n/*    color: #aaa;*/\r\n/*    float: right;*/\r\n/*    font-size: 28px;*/\r\n/*    font-weight: bold;*/\r\n/*}*/\r\n\r\n/*.close:hover,*/\r\n/*.close:focus {*/\r\n/*    color: black;*/\r\n/*    text-decoration: none;*/\r\n/*    cursor: pointer;*/\r\n/*}*/\r\n\r\n/* Form styles */\r\n/*form {*/\r\n/*    display: grid;*/\r\n/*    grid-template-columns: repeat(2, 1fr);*/\r\n/*    gap: 20px;*/\r\n/*}*/\r\n\r\n/*.form-group {*/\r\n/*    display: flex;*/\r\n/*    flex-direction: column;*/\r\n/*}*/\r\n\r\n/*.form-group label {*/\r\n/*    margin-bottom: 5px;*/\r\n/*    font-weight: bold;*/\r\n/*}*/\r\n\r\n/*.form-group input,*/\r\n/*.form-group select {*/\r\n/*    padding: 10px;*/\r\n/*    font-size: 1rem;*/\r\n/*    border: 1px solid #ccc;*/\r\n/*    border-radius: 5px;*/\r\n/*}*/\r\n\r\n/*button[type=\"submit\"] {*/\r\n/*    grid-column: 1;*/\r\n/*    padding: 15px;*/\r\n/*    font-size: 1.25rem;*/\r\n/*    border-radius: 5px;*/\r\n/*}*/",
      "controllerScript" : "const BaseURL = 'https://thingsboard.cloud'\r\n\r\nself.onInit = function() {\r\n    // Retrieve the JWT token from localStorage\r\n    let jwtToken = localStorage.getItem(\r\n        \"jwt_token\");\r\n\r\n    // Check if the token exists\r\n    if (jwtToken) {\r\n        // Call API function with the JWT token\r\n       fetchCustomerGroupFromApi(jwtToken);\r\n    } else {\r\n        document.getElementById(\"dataTable\")\r\n            .textContent =\r\n            \"JWT token not found.\";\r\n    }\r\n\r\n\r\n\r\n    document.addEventListener(\"keydown\", (e) => {\r\n        if (e.key === \"Escape\") {\r\n            document\r\n                .querySelectorAll(\r\n                    \".create-customer-modal, .edit-customer-modal, .delete-customer-modal\"\r\n                )\r\n                .forEach((modal) => {\r\n                    if (!modal.classList.contains(\"hidden\")) {\r\n                        toggleModal(modal.id);\r\n                    }\r\n                });\r\n        }\r\n    });\r\n\r\n    // Initialize DataTable\r\n    const table = $(\"#dataTable\")\r\n        .DataTable({\r\n            data: [],\r\n            columns: [{\r\n                    className: \"dt-control\",\r\n                    orderable: false,\r\n                    defaultContent: \"\",\r\n                },\r\n                {\r\n                    data: \"id.id\",\r\n                },\r\n                {\r\n                    data: \"name\",\r\n                },\r\n                {\r\n                    title: \"Actions\",\r\n                    data: null,\r\n                    defaultContent: `\r\n                    <button type=\"button\" class=\"text-blue-500 hover:text-blue-700 edit-group\" data-modal-toggle=\"EditGroup\">Edit</button>\r\n                    <button class=\"text-red-500 hover:text-red-700 delete-group\">Delete</button>\r\n                `,\r\n                },\r\n            ],\r\n        });\r\n\r\n    $(\"#dataTable tbody\").on(\"click\",\r\n        \".edit-group\",\r\n        function() {\r\n            const modalId = $(this)\r\n                .attr(\r\n                    \"data-modal-toggle\"\r\n                );\r\n            toggleModal(modalId);\r\n            var data = table.row($(this)\r\n                .parents(\r\n                    \"tr\")).data();\r\n        });\r\n\r\n    $(\"#dataTable tbody\").on(\"click\",\r\n        \".delete-group\",\r\n        function() {\r\n            var data = table.row($(this)\r\n                .parents(\r\n                    \"tr\")).data();\r\n            console.log(\r\n                \"Delete button clicked\"\r\n            );\r\n        });\r\n\r\n    $(\"#dataTable\").on(\"click\",\r\n        \"td.dt-control\",\r\n        function() {\r\n            let tr = $(this).closest(\r\n                \"tr\");\r\n            let row = table.row(tr);\r\n\r\n            if (row.child.isShown()) {\r\n                row.child.hide();\r\n                tr.removeClass(\"shown\");\r\n            } else {\r\n                row.child(format(row\r\n                        .data()))\r\n                    .show();\r\n                tr.addClass(\"shown\");\r\n                // Initialize DataTable for customer details\r\n                const uniqueId =\r\n                    `details-${row.data().id.id}`;\r\n                $(`#${uniqueId}`)\r\n                    .DataTable();\r\n\r\n                $(`#${uniqueId} tbody`)\r\n                    .on(\"click\",\r\n                        \".edit-customer\",\r\n                        function() {\r\n                            const\r\n                                modalId =\r\n                                $(this)\r\n                                .attr(\r\n                                    \"data-modal-toggle\"\r\n                                );\r\n                            toggleModal(\r\n                                modalId\r\n                            );\r\n                            const data =\r\n                                row\r\n                                .data()\r\n                                .customers\r\n                            // ดึง ID ของลูกค้าที่เลือกจากปุ่ม\r\n                            const rows =\r\n                                $(this)\r\n                                .closest(\r\n                                    \"tr\"\r\n                                );\r\n                            const\r\n                                rowData =\r\n                                $(\r\n                                    `#${uniqueId}`\r\n                                )\r\n                                .DataTable()\r\n                                .row(\r\n                                    rows\r\n                                )\r\n                                .data();\r\n                            const\r\n                                customerId =\r\n                                rowData[\r\n                                    0];\r\n                            // ค้นหาลูกค้าใน data โดยใช้ customerId\r\n                            const\r\n                                customer =\r\n                                data\r\n                                .find((\r\n                                        c\r\n                                    ) =>\r\n                                    c.id\r\n                                    .id ===\r\n                                    customerId\r\n                                );\r\n\r\n                            if (\r\n                                customer\r\n                            ) {\r\n                                populateUpdateModal\r\n                                    (\r\n                                        customer\r\n                                    ); // เรียกฟังก์ชันเพื่อเติมข้อมูลใน modal\r\n                            } else {\r\n                                alert(\"ไม่พบลูกค้าด้วย ID:\",\r\n                                    customerId\r\n                                );\r\n                            }\r\n                        });\r\n\r\n                $(`#${uniqueId} tbody`)\r\n                    .on(\r\n                        \"click\",\r\n                        \".delete-customer\",\r\n                        function() {\r\n                            const\r\n                                modalId =\r\n                                $(this)\r\n                                .attr(\r\n                                    \"data-modal-toggle\"\r\n                                );\r\n                            toggleModal(\r\n                                modalId\r\n                            );\r\n                            const data =\r\n                                row\r\n                                .data()\r\n                                .customers;\r\n                            deleteCustomer\r\n                                (data.id\r\n                                    .id\r\n                                );\r\n                        }\r\n                    );\r\n            }\r\n        });\r\n};\r\n\r\n// Submit the form\r\n$(\"#createCustomerBtn\").on(\"click\", function() {\r\n    const cusGroupID = $(\"#cus_group_id\").val();\r\n    const createData = {\r\n        additionalInfo: {\r\n            cus_usage_type: $(\"#cus_usage_type\")\r\n                .val(),\r\n            org_name: $(\"#org_name\").val(),\r\n            tax_num: $(\"#tax_num\").val(),\r\n            cus_dis_type: $(\"#cus_dis_type\")\r\n                .val(),\r\n        },\r\n        title: $(\"#fname\").val() + \" \" + $(\r\n            \"#lname\").val(),\r\n        email: $(\"#email_name\").val(),\r\n        phone: $(\"#phone_num\").val(),\r\n        address: $(\"#address_name\").val(),\r\n    };\r\n\r\n    getCreateAndUpdateCustomer(createData,\r\n        cusGroupID);\r\n    toggleModal(\"CreateNewCustomer\");\r\n});\r\n\r\nfunction populateUpdateModal(data) {\r\n    // Populate the form fields in the Update Customer Modal\r\n    $(\"#cus_group_id_update\").val(data.groups[0].id.id);\r\n    $(\"#cus_usage_type_update\").val(data.additionalInfo\r\n        .cus_usage_type);\r\n    $(\"#title_update\").val(data.title);\r\n    $(\"#org_name_update\").val(data.additionalInfo.org_name);\r\n    $(\"#tax_num_update\").val(data.additionalInfo.tax_num);\r\n    $(\"#email_name_update\").val(data.email);\r\n    $(\"#phone_num_update\").val(data.phone);\r\n    $(\"#address_name_update\").val(data.address);\r\n    $(\"#cus_dis_type_update\").val(data.additionalInfo\r\n        .cus_dis_type);\r\n\r\n    // Submit the form\r\n    $(\"#updateCustomerBtn\").on(\"click\", function() {\r\n        const token = localStorage.getItem(\r\n            \"jwt_token\");\r\n        const cusGroupID = data.groups[0].id.id;\r\n        const updatedData = {\r\n            id: data.id,\r\n            additionalInfo: {\r\n                cus_usage_type: $(\r\n                    \"#cus_usage_type_update\"\r\n                ).val() || \"\",\r\n                org_name: $(\"#org_name_update\")\r\n                    .val() || \"\",\r\n                tax_num: $(\"#tax_num_update\")\r\n                    .val() || \"\",\r\n                cus_dis_type: $(\r\n                        \"#cus_dis_type_update\")\r\n                    .val() || \"\",\r\n            },\r\n            title: $(\"#title_update\").val(),\r\n            email: $(\"#email_name_update\")\r\n                .val(),\r\n            phone: $(\"#phone_num_update\").val(),\r\n            address: $(\"#address_name_update\")\r\n                .val(),\r\n            ownerId: data.ownerId,\r\n            tenantId: data.tenantId,\r\n        };\r\n\r\n        getCreateAndUpdateCustomer(updatedData,\r\n            cusGroupID);\r\n        toggleModal(\"EditCustomer\");\r\n    });\r\n}\r\n\r\nfunction populateSelectOptions(selectElementId, data) {\r\n    const selectElement = document.getElementById(\r\n        selectElementId);\r\n    data.forEach((group) => {\r\n        const option = document.createElement(\r\n            \"option\");\r\n        option.value = group.id.id;\r\n        option.text = group.name;\r\n        selectElement.add(option);\r\n    });\r\n}\r\n\r\nfunction deleteCustomer(id) {\r\n    $(`#confirmDeleteButton`).on(\"click\", function() {\r\n        deleteEntry(id);\r\n        toggleModal(\"DeleteCustomer\");\r\n    });\r\n}\r\n\r\nasync function fetchCustomerGroupFromApi(token) {\r\n    const CustomerApiUrl = `${BaseURL}/api/customerInfos/all?pageSize=100&page=0`;\r\n    const GroupApiUrl = `${BaseURL}/api/entityGroupInfos/CUSTOMER?pageSize=100&page=0`;\r\n\r\n    try {\r\n        const customerResponse = await fetch(CustomerApiUrl, {\r\n            method: \"GET\",\r\n            headers: {\r\n                Authorization: `Bearer ${token}`,\r\n                Accept: \"application/json\",\r\n            },\r\n        });\r\n        const customerData = await customerResponse.json();\r\n        const CustomerData = customerData.data;\r\n\r\n        const groupResponse = await fetch(GroupApiUrl, {\r\n            method: \"GET\",\r\n            headers: {\r\n                Authorization: `Bearer ${token}`,\r\n                Accept: \"application/json\",\r\n            },\r\n        });\r\n        const groupData = await groupResponse.json();\r\n        let GroupData = groupData.data;\r\n\r\n        // Filter out \"All\"\r\n        GroupData = GroupData.filter(item => item.name !== \"All\");\r\n\r\n        populateSelectOptions(\"cus_group_id\", GroupData);\r\n        populateSelectOptions(\"cus_group_id_update\", GroupData);\r\n\r\n        const groupMap = GroupData.map((grp) => ({\r\n            id: grp.id,\r\n            name: grp.name,\r\n            customers: [],\r\n        }));\r\n\r\n        const groupLookup = groupMap.reduce((acc, grp) => {\r\n            acc[grp.id.id] = grp;\r\n            return acc;\r\n        }, {});\r\n\r\n        for (const customer of CustomerData) {\r\n            for (const grp of customer.groups) {\r\n                const groupId = grp.id.id;\r\n                if (groupLookup[groupId]) {\r\n                    groupLookup[groupId].customers.push(customer);\r\n                    for (const subCustomer of groupLookup[groupId].customers) {\r\n                        const subCustId = subCustomer.id.id;\r\n                        const subCustomerURL = `${BaseURL}/api/customer/${subCustId}/customerInfos?pageSize=100&page=0`;\r\n                        const subCustomerResponse = await fetch(subCustomerURL, {\r\n                            method: \"GET\",\r\n                            headers: {\r\n                                Authorization: `Bearer ${token}`,\r\n                                Accept: \"application/json\",\r\n                            },\r\n                        });\r\n                        const subCustomerData = await subCustomerResponse.json();\r\n                        if (!subCustomer.subCustomers) {\r\n                            subCustomer.subCustomers = [];\r\n                        }\r\n                        subCustomer.subCustomers = subCustomerData.data;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        $(\"#dataTable\").DataTable().clear().rows.add(groupMap).draw();\r\n        \r\n        // document.getElementById(\"demo\").textContent = JSON.stringify(groupMap, undefined, 4);\r\n    } catch (error) {\r\n        console.error(\"Error fetching data:\", error);\r\n    }\r\n}\r\n\r\n\r\nfunction deleteEntry(cus_id) {\r\n    const jwtToken = localStorage.getItem(\"jwt_token\");\r\n\r\n    fetch(`${BaseURL}/customer/${cus_id}`, {\r\n            method: \"DELETE\",\r\n            headers: {\r\n                Authorization: `Bearer ${jwtToken}`,\r\n                \"Content-Type\": \"application/json\",\r\n            },\r\n        })\r\n        .then((response) => {\r\n            if (response.status === 200) {\r\n                alert(\"Entry deleted successfully\");\r\n                fetchCustomerGroupFromApi(\r\n                    jwtToken); // Refresh the table data\r\n            } else if (response.status === 400) {\r\n                return response.json().then((error) => {\r\n                    alert(\r\n                        `Error: ${error.message}`\r\n                    );\r\n                });\r\n            } else if (response.status === 404) {\r\n                alert(\"Error: Entry not found\");\r\n            } else {\r\n                throw new Error(\r\n                    \"Network response was not ok\");\r\n            }\r\n        })\r\n        .catch((error) => {\r\n            alert(\r\n                `Error deleting entry: ${error.message}`\r\n            );\r\n        });\r\n}\r\n\r\nfunction getCreateAndUpdateCustomer(data, cusGroupID) {\r\n    const token = localStorage.getItem(\"jwt_token\");\r\n\r\n    fetch(\r\n            `${BaseURL}/customer?entityGroupId=${cusGroupID}`, {\r\n                method: \"POST\",\r\n                headers: {\r\n                    Authorization: `Bearer ${token}`,\r\n                    \"Content-Type\": \"application/json\",\r\n                },\r\n                body: JSON.stringify(data),\r\n            }\r\n        )\r\n        .then((response) => {\r\n            if (response.status === 200 || response\r\n                .status === 201) {\r\n                return response.json().then((\r\n                    customer) => {\r\n                    alert(\r\n                        \"Entry created successfully\"\r\n                    );\r\n                    fetchCustomerGroupFromApi(\r\n                        token\r\n                    ); // Refresh the table data\r\n                });\r\n            } else if (response.status === 400) {\r\n                return response.json().then((error) => {\r\n                    alert(\r\n                        `Error: ${error.message}`\r\n                    );\r\n                });\r\n            } else {\r\n                throw new Error(\r\n                    \"Network response was not ok\");\r\n            }\r\n        })\r\n        .catch((error) => {\r\n            alert(\r\n                `Error creating entry: ${error.message}`\r\n            );\r\n        });\r\n}\r\n\r\nfunction format(d) {\r\n    // Generate a unique ID for each row\r\n    const uniqueId = `details-${d.id.id}`;\r\n\r\n    return `\r\n            <table cellpadding=\"5\" cellspacing=\"0\" border=\"0\" class=\"w-full\">\r\n                <tr>\r\n                    <td colspan=\"2\">\r\n                        <table id=\"${uniqueId}\" class=\"display\" style=\"width:100%\">\r\n                            <thead>\r\n                                <tr>\r\n                                    <th>Customer ID</th>\r\n                                    <th>Customer Name</th>\r\n                                    <th>Actions</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                ${d.customers\r\n                                  .map(\r\n                                    (customer) => `\r\n                                    <tr>\r\n                                        <td>${customer.id.id}</td>\r\n                                        <td>${customer.name}</td>\r\n                                        <td>\r\n                                            <button class=\"text-white bg-blue-500 hover:bg-blue-700 border p-1 font-semibold rounded-md edit-customer\" data-modal-toggle=\"EditCustomer\">Edit</button>\r\n                                            <button class=\"text-white bg-red-500 hover:bg-red-700 border p-1 font-semibold rounded-md delete-customer\" data-modal-toggle=\"DeleteCustomer\">Delete</button>\r\n                                        </td>\r\n                                    </tr>\r\n                                `\r\n                                  )\r\n                                  .join(\"\")}\r\n                            </tbody>\r\n                        </table>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            `;\r\n}\r\n\r\nfunction toggleModal(modalId) {\r\n    const modal = document.getElementById(modalId);\r\n    if (!modal) return;\r\n\r\n    const modalContent = modal.querySelector(\r\n        \".modal-content\");\r\n\r\n    if (modal.classList.contains(\"hidden\")) {\r\n        modal.classList.remove(\"hidden\");\r\n        setTimeout(() => {\r\n            modal.classList.remove(\"opacity-0\");\r\n            modal.classList.add(\"opacity-100\");\r\n            modalContent.classList.remove(\r\n                \"scale-95\");\r\n            modalContent.classList.add(\"scale-100\");\r\n        }, 10);\r\n    } else {\r\n        modal.classList.remove(\"opacity-100\");\r\n        modal.classList.add(\"opacity-0\");\r\n        modalContent.classList.remove(\"scale-100\");\r\n        modalContent.classList.add(\"scale-95\");\r\n        modal.addEventListener(\r\n            \"transitionend\",\r\n            () => {\r\n                modal.classList.add(\"hidden\");\r\n            }, {\r\n                once: true,\r\n            }\r\n        );\r\n    }\r\n}",
      "settingsSchema" : "",
      "dataKeySettingsSchema" : "",
      "settingsDirective" : "tb-html-card-widget-settings",
      "defaultConfig" : "{\"datasources\":[{\"type\":\"static\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"rgb(255, 255, 255)\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"cardHtml\":\"<div class='card'>HTML code here</div>\",\"cardCss\":\".card {\\n    font-weight: bold;\\n    font-size: 32px;\\n    color: #999;\\n    width: 100%;\\n    height: 100%;\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n}\"},\"title\":\"HTML Card\",\"dropShadow\":true}"
    },
    "externalId" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "46286d60-50d7-11ef-887e-effae2bd2f60"
    },
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}